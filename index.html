<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TekiTrip</title>

<style>
  body {
    font-family: sans-serif;
    padding: 16px;
    margin: 0;
    line-height: 1.6;
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  select, button {
    width: 100%;
    padding: 14px;
    font-size: 18px;
    margin: 8px 0;
    border-radius: 8px;
  }
  #results div {
    background: #f5f5f5;
    padding: 14px;
    margin-bottom: 12px;
    border-radius: 8px;
  }
  #retryBtn {
    background: #ffaa33;
    color: #000;
    border: none;
    font-weight: bold;
  }
  #searchBtn {
    background: #0078ff;
    color: white;
    border: none;
  }
</style>

<script>
// ★ バージョン番号（キャッシュバスター）を YYYYMMDDHHMM 形式で生成
function makeVersion() {
  const d = new Date();
  const pad = n => String(n).padStart(2, "0");

  return (
    d.getFullYear() +
    pad(d.getMonth() + 1) +
    pad(d.getDate()) +
    pad(d.getHours()) +
    pad(d.getMinutes())
  );
}

const VERSION = makeVersion();

// ★ config.js と app.js を動的にロード（毎回キャッシュ無効）
function loadLocalScripts() {
  const scripts = ["config.js", "app.js"];

  scripts.forEach(name => {
    const s = document.createElement("script");
    s.src = `${name}?v=${VERSION}`;  // 自動バージョン付加
    document.head.appendChild(s);
  });
}

// ★ Google Maps API をロード
function loadMaps() {
  const s = document.createElement("script");
  s.src =
    "https://maps.googleapis.com/maps/api/js?key=" +
    window.APP_CONFIG.GOOGLE_MAPS_API_KEY +
    "&libraries=places&callback=initApp";
  s.async = true;
  document.head.appendChild(s);
}

// index.htmlロード完了時にまず config.js / app.js をロードし、そのあと Maps をロード
window.onload = () => {
  loadLocalScripts();
  // Maps API は config.js 読み込み後に init される必要があるため少し遅延させる
  setTimeout(loadMaps, 300);
};
</script>
</head>

<body>
<h2>TekiTrip（ランダム旅行提案）</h2>

<div>
  <label>カテゴリ：</label>
  <select id="category">
    <option value="food">フード＆ドリンク</option>
    <option value="shopping">ショッピング</option>
    <option value="outdoor">アウトドア＆レクリエーション</option>
    <option value="stay">宿泊地</option>
  </select>
</div>

<div>
  <label>距離：</label>
  <select id="distance">
    <option value="near">すぐ行ける（15km）</option>
    <option value="mid">1日で行く（100km）</option>
    <option value="far">旅行で行く（200〜500km）</option>
  </select>
</div>

<button id="searchBtn">提案！</button>

<p id="status"></p>
<div id="results"></div>

<!-- map領域（透明） -->
<div id="hiddenMap" style="width:1px;height:1px;opacity:0;"></div>

</body>
</html>
